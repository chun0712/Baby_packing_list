<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- === 分享資訊設定區 (修改這裡即可改分享文字) === -->
    <title>比比の待產包</title>
    <meta name="description" content="專為媽咪設計的待產包清單，支援單機儲存與 Excel 匯出，讓準備過程更輕鬆、更有條理。">

    <!-- Open Graph (用於 LINE/FB 分享) -->
    <meta property="og:title" content="比比の待產包">
    <meta property="og:description" content="最溫馨的待產準備 App，清單、備註、數量一目了然！">
    <meta property="og:type" content="website">
    <!-- === 分享資訊設定區結束 === -->

    <!-- 核心套件 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
            background-color: #FFFDF5;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .check-box {
            border: 2.5px solid #D3BFA9;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
            background: white;
        }
        .check-box.checked {
            border-color: #dc2626;
        }

        .pb-safe {
            padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));
        }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(0.5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-0.5deg); }
            100% { transform: rotate(0deg); }
        }
        .editing-shake {
            animation: shake 0.3s infinite;
        }

        .item-enter { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-[#FFFDF5]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i ref={iconRef} data-lucide={name} style={{ width: size, height: size, display: 'inline-block' }} className={className}></i>;
        };

        const RedCheckIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#dc2626" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const App = () => {
            const [categories, setCategories] = useState(() => {
                const saved = localStorage.getItem('maternity_categories_v7');
                return saved ? JSON.parse(saved) : ['醫院包', '汭恩待產包', '月中行李'];
            });

            const [activeCategory, setActiveCategory] = useState('醫院包');
            const [isEditingCategory, setIsEditingCategory] = useState(false);
            const [newItemName, setNewItemName] = useState('');
            const [newItemRemark, setNewItemRemark] = useState('');
            const [expandedItems, setExpandedItems] = useState(new Set());

            const [items, setItems] = useState(() => {
                const saved = localStorage.getItem('maternity_bag_data_v7');
                if (saved) return JSON.parse(saved);

                const defaultItems = [
                    { category: '醫院包', name: '益生菌', checked: true, remark: '' },
                    { category: '醫院包', name: '軟便劑', checked: true, remark: '' },
                    { category: '醫院包', name: '棉花棒', checked: true, remark: '' },
                    { category: '醫院包', name: '吸管杯', checked: true, remark: '' },
                    { category: '醫院包', name: '讀卡機', checked: true, remark: '' },
                    { category: '醫院包', name: '洗面乳（中和）、卸妝巾', checked: false, remark: '' },
                    { category: '醫院包', name: '化妝水（中和）', checked: true, remark: '' },
                    { category: '醫院包', name: '束腹帶（中和）', checked: true, remark: '' },
                    { category: '醫院包', name: '鯊魚夾、梳子、綁頭髮（中和）', checked: false, remark: '' },
                    { category: '醫院包', name: '牙線棒', checked: true, remark: '' },
                    { category: '醫院包', name: '一套出院服（媽媽）', checked: true, remark: '' },
                    { category: '醫院包', name: '彎曲吸管（放醫院包）', checked: true, remark: '' },
                    { category: '醫院包', name: '口罩', checked: true, remark: '' },
                    { category: '醫院包', name: '防溢乳墊', checked: true, remark: '' },
                    { category: '醫院包', name: '安睡褲（穿著去醫院）', checked: true, remark: '' },
                    { category: '醫院包', name: '香草奶嘴、微笑奶嘴', checked: true, remark: '' },
                    { category: '醫院包', name: '屁屁噴', checked: true, remark: '' },
                    { category: '醫院包', name: '卵磷脂、回汝茶', checked: true, remark: '' },
                    { category: '醫院包', name: '綜合維他命', checked: true, remark: '' },
                    { category: '醫院包', name: '拖鞋', checked: true, remark: '' },
                    { category: '醫院包', name: '中和帶「睡衣、除毛刀」', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '衛生紙', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '包巾', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '棉衣（寶寶出院服）', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '環保餐具', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '看護墊', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '免洗內褲', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '沖洗器', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '濕紙巾', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '牙刷牙膏', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '熱敷袋', checked: true, remark: '' },
                    { category: '汭恩待產包', name: '旅行沐浴', checked: true, remark: '' },
                    { category: '月中行李', name: '爸爸媽媽雙證件（身分證健保卡）', checked: true, remark: '' },
                    { category: '月中行李', name: '爸爸媽媽印章', checked: true, remark: '' },
                    { category: '月中行李', name: '戶口名簿', checked: true, remark: '' },
                    { category: '月中行李', name: '出生證明（醫院）', checked: false, remark: '' },
                    { category: '月中行李', name: '媽媽手冊', checked: true, remark: '' },
                    { category: '月中行李', name: '月中契約', checked: true, remark: '' },
                    { category: '月中行李', name: 'L夾', checked: true, remark: '' },
                    { category: '月中行李', name: '化妝品‼️', checked: true, remark: '' },
                    { category: '月中行李', name: '外套一件‼️', checked: true, remark: '' },
                    { category: '月中行李', name: '平板‼️', checked: true, remark: '' },
                    { category: '月中行李', name: '充電器‼️', checked: true, remark: '' },
                    { category: '月中行李', name: '彈性襪', checked: true, remark: '' },
                    { category: '月中行李', name: '刮鬍刀', checked: false, remark: '' },
                    { category: '月中行李', name: '口罩', checked: false, remark: '' },
                    { category: '月中行李', name: '相機', checked: true, remark: '' },
                    { category: '月中行李', name: '行動電源', checked: true, remark: '' },
                    { category: '月中行李', name: '耳機', checked: true, remark: '' },
                    { category: '月中行李', name: '衣架', checked: true, remark: '' },
                    { category: '月中行李', name: '保養品', checked: true, remark: '' },
                    { category: '月中行李', name: '指甲剪', checked: true, remark: '' },
                    { category: '月中行李', name: '剪刀/美工刀', checked: true, remark: '' },
                    { category: '月中行李', name: '妊娠油/妊娠霜', checked: true, remark: '' },
                    { category: '月中行李', name: '安睡褲', checked: true, remark: '' },
                    { category: '月中行李', name: '免洗內褲XL（高腰）', checked: true, remark: '' },
                    { category: '月中行李', name: '看護墊', checked: true, remark: '' },
                    { category: '月中行李', name: '衛生棉（夜用）、日用', checked: true, remark: '' },
                    { category: '月中行李', name: '外出服或出院穿（媽媽&小孩*2套 +包巾）', checked: true, remark: '' },
                    { category: '月中行李', name: '保健食品（綜合維他命、卵磷脂、回汝茶）', checked: true, remark: '' },
                    { category: '月中行李', name: '奶粉（試用罐）', checked: true, remark: '' }
                ];

                return defaultItems.map((item, idx) => ({
                    id: crypto.randomUUID(),
                    count: 1,
                    createdAt: Date.now() + idx,
                    ...item
                }));
            });

            useEffect(() => {
                localStorage.setItem('maternity_bag_data_v7', JSON.stringify(items));
            }, [items]);

            useEffect(() => {
                localStorage.setItem('maternity_categories_v7', JSON.stringify(categories));
            }, [categories]);

            const addCategory = () => {
                const name = prompt('請輸入新分類名稱：');
                if (name && !categories.includes(name)) {
                    setCategories([...categories, name]);
                    setActiveCategory(name);
                }
            };

            const renameCategory = (oldName) => {
                const newName = prompt('修改分類名稱：', oldName);
                if (newName && newName !== oldName) {
                    setCategories(prev => prev.map(c => c === oldName ? newName : c));
                    setItems(prev => prev.map(item => item.category === oldName ? { ...item, category: newName } : item));
                    if (activeCategory === oldName) setActiveCategory(newName);
                }
            };

            const deleteCategory = (name) => {
                if (categories.length <= 1) {
                    alert('至少需保留一個分類');
                    return;
                }
                if (confirm(`確定要刪除「${name}」分類及其所有項目嗎？`)) {
                    const newCats = categories.filter(c => c !== name);
                    setCategories(newCats);
                    setItems(prev => prev.filter(item => item.category !== name));
                    if (activeCategory === name) setActiveCategory(newCats[0]);
                }
            };

            const toggleExpand = (id) => {
                const next = new Set(expandedItems);
                if (next.has(id)) next.delete(id);
                else next.add(id);
                setExpandedItems(next);
            };

            const toggleCheck = (id) => {
                setItems(prev => prev.map(item => item.id === id ? { ...item, checked: !item.checked } : item));
            };

            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newItemName.trim()) return;
                setItems(prev => [{
                    id: crypto.randomUUID(),
                    name: newItemName,
                    remark: newItemRemark.trim(),
                    category: activeCategory,
                    checked: false,
                    count: 1,
                    createdAt: Date.now()
                }, ...prev]);
                setNewItemName('');
                setNewItemRemark('');
            };

            const exportExcel = () => {
                const data = items.map(i => ({
                    '分類': i.category,
                    '名稱': i.name,
                    '備註': i.remark || '',
                    '數量': i.count,
                    '狀態': i.checked ? '已準備' : '待辦'
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "清單");
                XLSX.writeFile(wb, `比比の待產包_V7_${new Date().toLocaleDateString()}.xlsx`);
            };

            const filteredItems = items.filter(i => i.category === activeCategory);
            const doneCount = filteredItems.filter(i => i.checked).length;

            return (
                <div className="min-h-screen bg-[#FFFDF5] text-[#5D4037] pb-48">
                    <header className="bg-white/95 backdrop-blur-md sticky top-0 z-50 p-4 shadow-sm border-b border-[#F5E6D3] flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className="bg-[#FFEDD5] p-2 rounded-full">
                                <Icon name="baby" className="text-[#E67E22]" size={20} />
                            </div>
                            <div>
                                <h1 className="font-bold text-lg leading-tight">比比の待產包</h1>
                                <p className="text-[10px] text-[#A0816C]"></p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button
                                onClick={() => setIsEditingCategory(!isEditingCategory)}
                                className={`flex items-center gap-1.5 px-3 py-2 rounded-xl border border-[#F5E6D3] active:scale-95 transition-all shadow-sm ${isEditingCategory ? 'bg-[#E67E22] text-white shadow-inner scale-105' : 'bg-[#FFF2E6] text-[#E67E22]'}`}
                            >
                                <Icon name="tag" size={16} />
                                <span className="text-xs font-bold">{isEditingCategory ? '完成編輯' : '標籤編輯'}</span>
                            </button>
                            <button
                                onClick={exportExcel}
                                className="flex items-center gap-1.5 px-3 py-2 bg-emerald-600 text-white rounded-xl active:scale-95 shadow-sm border border-emerald-700"
                            >
                                <Icon name="download" size={16} />
                                <span className="text-xs font-bold">匯出</span>
                            </button>
                        </div>
                    </header>

                    <nav className="sticky top-[68px] bg-[#FFFDF5]/90 backdrop-blur-md z-40 flex px-4 py-4 gap-2 overflow-x-auto no-scrollbar items-center border-b border-[#F5E6D3]/30">
                        {categories.map(cat => (
                            <div key={cat} className="flex-shrink-0 flex items-center gap-1">
                                <button
                                    onClick={() => !isEditingCategory && setActiveCategory(cat)}
                                    className={`whitespace-nowrap px-6 py-2 rounded-2xl text-sm font-bold transition-all flex items-center gap-2 ${
                                        activeCategory === cat && !isEditingCategory ? 'bg-[#E67E22] text-white shadow-md' : 'bg-white border border-[#F5E6D3] text-[#A0816C]'
                                    } ${isEditingCategory ? 'border-dashed border-2 border-orange-300 editing-shake bg-orange-50' : ''}`}
                                >
                                    {cat}
                                    {isEditingCategory && (
                                        <div className="flex items-center gap-2 ml-2 border-l border-orange-200 pl-2">
                                            <span onClick={(e) => { e.stopPropagation(); renameCategory(cat); }} className="text-orange-600 active:text-orange-800 p-1"><Icon name="pencil" size={14}/></span>
                                            <span onClick={(e) => { e.stopPropagation(); deleteCategory(cat); }} className="text-red-500 active:text-red-800 p-1"><Icon name="trash-2" size={14}/></span>
                                        </div>
                                    )}
                                </button>
                            </div>
                        ))}
                        {!isEditingCategory && (
                            <button onClick={addCategory} className="flex-shrink-0 p-2 bg-white border-2 border-dashed border-[#F5E6D3] text-[#D3BFA9] rounded-full active:border-[#E67E22] active:text-[#E67E22]">
                                <Icon name="plus" size={16} />
                            </button>
                        )}
                    </nav>

                    <main className="px-4 max-w-md mx-auto pt-4">
                        <div className="bg-white rounded-3xl p-5 mb-6 border border-[#F5E6D3] shadow-sm">
                            <div className="flex justify-between items-end mb-3">
                                <span className="text-[11px] font-bold text-[#A0816C] uppercase tracking-widest">{activeCategory}</span>
                                <div className="text-right">
                                    <span className="text-[10px] text-[#D3BFA9] block mb-1">完成進度</span>
                                    <span className="text-2xl font-black text-[#E67E22]">
                                        {doneCount}<span className="text-sm text-[#D3BFA9] mx-1">/</span>{filteredItems.length}
                                    </span>
                                </div>
                            </div>
                            <div className="w-full bg-[#F5E6D3]/50 h-3 rounded-full overflow-hidden">
                                <div className="bg-gradient-to-r from-[#FFB347] to-[#E67E22] h-full transition-all duration-700 rounded-full" style={{ width: `${(doneCount / Math.max(1, filteredItems.length)) * 100}%` }} />
                            </div>
                        </div>

                        <div className="space-y-2.5">
                            {filteredItems.map(item => {
                                const isExpanded = expandedItems.has(item.id);
                                return (
                                    <div key={item.id} className="item-enter bg-white rounded-2xl border border-[#F5E6D3] shadow-sm overflow-hidden transition-all">
                                        <div className="flex items-start gap-3 p-3.5">
                                            <div className={`check-box mt-0.5 ${item.checked ? 'checked' : ''}`} onClick={() => toggleCheck(item.id)}>{item.checked && <RedCheckIcon />}</div>
                                            <div className="flex-grow min-w-0 py-0.5" onClick={() => toggleExpand(item.id)}>
                                                <span className={`text-[15px] font-bold block leading-snug transition-all ${item.checked ? 'text-[#A0816C]' : 'text-[#5D4037]'} ${!isExpanded ? 'truncate' : 'whitespace-normal'}`}>{item.name}</span>
                                                {item.remark && <p className="text-[11px] text-[#A0816C] mt-1 font-medium bg-[#F9F5F0] inline-block px-1.5 py-0.5 rounded leading-tight">{item.remark}</p>}
                                            </div>
                                            <div className="flex items-center gap-1 bg-[#F9F5F0] rounded-lg px-2 py-1.5 border border-[#F5E6D3]/50 flex-shrink-0">
                                                <button onClick={() => setItems(prev => prev.map(i => i.id === item.id ? {...i, count: Math.max(1, i.count-1)} : i))} className="p-1"><Icon name="minus" size={14} /></button>
                                                <span className="text-sm font-black w-5 text-center">{item.count}</span>
                                                <button onClick={() => setItems(prev => prev.map(i => i.id === item.id ? {...i, count: i.count+1} : i))} className="p-1 text-[#E67E22]"><Icon name="plus" size={14} /></button>
                                            </div>
                                            <button onClick={() => setItems(prev => prev.filter(i => i.id !== item.id))} className="text-[#D3BFA9] p-1 mt-0.5 active:text-red-500"><Icon name="trash-2" size={16} /></button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 p-4 pb-safe bg-gradient-to-t from-[#FFFDF5] via-[#FFFDF5] to-transparent z-50">
                        <div className="max-w-md mx-auto bg-white p-3 rounded-3xl shadow-[0_-10px_40px_rgba(93,64,55,0.1)] border border-[#F5E6D3]">
                            <form onSubmit={handleAddItem} className="flex items-center gap-3">
                                <div className="flex-grow flex flex-col gap-1.5">
                                    <input type="text" value={newItemName} onChange={(e) => setNewItemName(e.target.value)} placeholder={`新增項目名稱...`} className="w-full bg-[#F9F5F0] px-4 py-2.5 text-sm rounded-xl focus:outline-none focus:ring-2 focus:ring-[#E67E22]/20 transition-all font-bold placeholder:font-normal" />
                                    <input type="text" value={newItemRemark} onChange={(e) => setNewItemRemark(e.target.value)} placeholder="點此輸入備註 (選填)..." className="w-full bg-[#F9F5F0]/50 px-4 py-1.5 text-[11px] rounded-lg focus:outline-none transition-all italic placeholder:not-italic" />
                                </div>
                                <button type="submit" className="bg-[#E67E22] text-white w-14 h-14 rounded-2xl flex flex-col items-center justify-center shadow-lg shadow-[#E67E22]/30 active:scale-90 disabled:opacity-30 transition-all flex-shrink-0 border-b-4 border-[#C86610]" disabled={!newItemName.trim()}>
                                    <Icon name="plus" size={24} /><span className="text-[10px] font-bold mt-[-2px]">新增</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>